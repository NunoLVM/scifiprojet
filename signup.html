<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="The Popcorn Awakens | Sign Up for epic sci-fi experiences. Join our universe of movies and games, and get exclusive access to futuristic content." />
    <meta name="author" content="Nuno Antonio" />
    <meta name="keywords" content="sci-fi, signup, form, movies, games, futuristic" />
    <title>The Popcorn Awakens | Sign Up</title>
    <link id="main-css" rel="stylesheet" href="dist/css/theme.css" />
    <link rel="icon" type="image/x-icon" href="images/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet" />
  </head>

  <body>
    <header class="main-header">
      <div class="header-row">
        <a href="index.html">
          <img src="images/logo.svg" alt="Robot holding a popcorn bucket, The Popcorn Awakens logo" class="logo" />
        </a>
        <div class="header-right">
          <nav class="navbar" aria-label="Main Navigation" id="menu"></nav>
          <h1 class="title">The Popcorn Awakens!</h1>
        </div>
      </div>
    </header>

    <main>
      <section class="intro">
        <h2>You’ve Taken the Red Pill — Let’s Go Deeper</h2>
        <p>
          Join the Universe of Sci-Fi Cinema. Dive into a universe where classic and cult sci-fi films converge into a
          single portal for movie lovers. Sign up now to unlock personalized film recommendations, engage in
          intergalactic discussions, and discover hidden gems from galaxies far, far away. Simply fill in your details
          below to start your adventure among the stars!
        </p>
      </section>

      <section class="signup">
        <div class="signup-form-container">
          <div class="signup-header">
            <div class="icon-container">
              <img src="images/user_icon3.webp" alt="Sci‑Fi Icon" class="signup-icon" />
            </div>
            <div class="text-container">
              <h3>Access Granted: Create Your Account</h3>
            </div>
          </div>
          <form id="signup-form" aria-label="Sign Up Form">
            <div class="form-group">
              <label for="username">Choose your codename</label>
              <input type="text" id="username" name="username" placeholder="Enter call sign" required />
            </div>
            <div class="form-group">
              <label for="email">Email Address:</label>
              <input type="email" id="email" name="email" placeholder="Transmission address required" required />
            </div>
            <div class="form-group">
              <label for="password">Create launch code</label>
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Enter your access key"
                required
                minlength="8"
                pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                title="Must contain at least one number, one uppercase and lowercase letter, and at least 8 or more characters" />
            </div>
            <div class="form-group">
              <label for="confirm-password">Confirm launch code:</label>
              <input
                type="password"
                id="confirm-password"
                name="confirm-password"
                placeholder="Confirm your access key"
                required />
            </div>
            <div class="button-arrow-group">
              <button type="submit" class="button">Finalize Entry Protocol</button>

              <div class="signup-message">
                <p class="terminal-line line-1">New recruit detected.</p>
                <p class="terminal-line line-2">Credentials locked and verified.</p>
              </div>

              <a href="index.html" class="back-home-link">
                <img src="images/backhome.webp" alt="Back to Home" class="back-arrow" />
              </a>
            </div>
          </form>
        </div>
      </section>
    </main>

    <footer class="footer-main">
      <div class="footer-content">
        <div class="footer-row">
          <img src="images/popcorn.webp" alt="Popcorn bucket" class="footer-logo" />
          <div class="footer-right">
            <nav id="footerMenu" class="footer-nav" aria-label="Footer Navigation"></nav>
            <p class="footer-copy">
              © 2025 The Popcorn Awakens! All rights reserved. Movie data © TMDB. Game data © IGDB.
            </p>
          </div>
        </div>
      </div>
    </footer>

    
   <script type="module">
      import { resolveApiBase } from "./assets/scripts/utils/api.js";

    const API_BASE = resolveApiBase();

    // Validação simples
   document.getElementById("signup-form").addEventListener("submit", async function (e) {
        e.preventDefault(); // Impede o envio tradicional


     const username = document.getElementById("username").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        // Validação simples
        if (!username || !email || !password) {
          alert("Todos os campos são obrigatórios.");
          return;
        }

      try {
          const response = await fetch(`${API_BASE}/api/signup`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ username, email, password }),
          });


     const data = await response.json();

          if (response.ok) {
            alert("Conta criada com sucesso!");
            sessionStorage.setItem("showLoginAfterSignup", "true");
            window.location.href = "index.html";
          } else {
            alert(data.message || "Erro ao criar conta.");
          }
        } catch (error) {
          console.error("Erro na requisição:", error);
          alert("Erro de rede ou servidor.");
        }
      });
    </script>
  </body>
</html>
